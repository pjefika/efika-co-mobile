import { Injectable } from '@angular/core';
import { UrlService } from '../../providers/url-service/url.service';
import { SuperService } from '../../providers/super-service/super.service';
import { Cadastro } from '../../view-model/cadastro/cadastro';
import { TaskProcess } from '../../view-model/task-process/task-process';
import { Certification } from '../../view-model/certification/certification';

declare var require: any

@Injectable()
export class FulltestService extends SuperService {

    constructor(private urlService: UrlService) {
        super();
    }

    public doFulltest(cadastro: Cadastro): Promise<TaskProcess> {
        let userSession = JSON.parse(sessionStorage.getItem("user"));
        let _data: { task: string, input: { type: string, customer: Cadastro }, executor: string };
        _data = { task: "CERTIFICATION", input: { type: "certification", customer: cadastro }, executor: userSession.user };
        this.infoResquest = {
            rqst: "post",
            command: this.urlService.queueAPI + "task/process/",
            _data: _data,
            timeout: 180000
        };
        return this.urlService
            .request(this.infoResquest)
            .then(response => {
                return response as TaskProcess
            })
            .catch(super.handleError);
    }

    public doFulltestMock(): Certification {
        let cert: Certification;
        //Metalico        
        // cert = JSON.parse('{"resultado":"FISICAL","orientacao":"Parâmetros fora dos padrões.","id":"5a9d5691cb66bf19d54c4122","blocks":[{"resultado":"OK","orientacao":"OK","asserts":[{"resultado":"OK","orientacao":"Não há bloqueio no Radius.","nome":"HAS_BLOQ_RADIUS"},{"resultado":"OK","orientacao":"Radius e Inventário de Rede OK.","nome":"IS_INV_REDE_EQUALS_RADIUS"},{"resultado":"OK","orientacao":"Inventário de Rede OK.","nome":"HAS_INV_REDE"},{"resultado":"OK","orientacao":"Inventário de Serviços OK.","nome":"HAS_INV_SERV"}],"nome":{"name":"CADASTRO","beautyName":"Cadastro"}},{"resultado":"OK","orientacao":"OK","asserts":[{"resultado":"OK","orientacao":"Rede confiável.","nome":"IS_REDE_BANDA_OK"}],"nome":{"name":"PERFORMANCE","beautyName":"Performance"}},{"resultado":"OK","orientacao":"OK","asserts":[{"resultado":"OK","orientacao":"Vlan de Banda configurado corretamente.","nome":"IS_VLANS_OK"},{"resultado":"OK","orientacao":"Profile configurado corretamente.","nome":"IS_PROFILE_OK"}],"nome":{"name":"SERVICOS","beautyName":"Serviços"}},{"resultado":"FISICAL","orientacao":"Parâmetros fora dos padrões.","asserts":[{"resultado":"OK","orientacao":"Porta Ativada (Adm state Up).","nome":"IS_ADM_UP"},{"resultado":"OK","orientacao":"Sincronismo/Link OK.","nome":"IS_OPER_UP"},{"resultado":"FISICAL","orientacao":"Parâmetros fora dos padrões.","nome":"IS_PARAM_OK"},{"resultado":"OK","orientacao":"Modulação configurada corretamente.","nome":"IS_MODUL_OK"},{"resultado":"OK","orientacao":"Mac identificado 28:C8:7A:19:67:18.","nome":"HAS_MAC_DSLAM"}],"nome":{"name":"CONECTIVIDADE","beautyName":"Conectividade"}}],"dataInicio":1520260694104,"dataFim":1520260753628,"customer":{"designador":"CTA-81E2J3HSS-013","instancia":"4131543457","designadorAcesso":"CTA-04887444-069","designadorTv":"TV-CTA-81E2J3HST-050","rede":{"tipo":"METALICA","origem":"ONLINE","planta":"VIVO2","ipDslam":"10.200.30.177","vendorDslam":"KEYMILE","modeloDslam":"SUVD11","idOnt":null,"terminal":null,"ipMulticast":null,"nrc":null,"slot":3,"porta":37,"sequencial":1085,"logica":1085,"rin":74,"vlanVoip":1074,"vlanVod":3074,"vlanMulticast":4000,"cvlan":1185,"bhs":null},"redeExterna":{"tipo":null,"origem":null,"planta":null,"splitter1n":null,"splitter2n":null,"caboAlim":null,"fibra1n":null,"fibra2n":null},"servicos":{"velDown":51200,"velUp":5120,"tipoTv":"DTH","tipoLinha":"TDM"},"linha":{"tipo":"TDM","dn":"4131543457","central":"PRCTA_PVS01"},"radius":{"status":"ATIVO","armario":"PRCTA_O1C50","rin":"074","velocidade":"51200 - 5120","ipFixo":"-","profile":"r5120b51200","porta":"1085","isIpFixo":false},"asserts":[{"asserts":"DIVERGENCIA_TBS_RADIUS","value":false,"creationDate":1520260277352},{"asserts":"CIRCUITO_ATIVO","value":true,"creationDate":1520260277352},{"asserts":"HAS_BLOQUEIO_RADIUS","value":false,"creationDate":1520260277352}],"eventos":[]},"executor":"G0034481","fulltest":{"resultado":false,"dataInicio":1520260641353,"dataFim":1520260700787,"mensagem":"Parâmetros fora dos padrões.","id":null,"cl":{"designador":"CTA-81E2J3HSS-013","instancia":"4131543457","designadorAcesso":"CTA-04887444-069","designadorTv":"TV-CTA-81E2J3HST-050","rede":{"tipo":"METALICA","origem":"ONLINE","planta":"VIVO2","ipDslam":"10.200.30.177","vendorDslam":"KEYMILE","modeloDslam":"SUVD11","idOnt":null,"terminal":null,"ipMulticast":null,"nrc":null,"slot":3,"porta":37,"sequencial":1085,"logica":1085,"rin":74,"vlanVoip":1074,"vlanVod":3074,"vlanMulticast":4000,"cvlan":1185,"bhs":null},"redeExterna":{"tipo":null,"origem":null,"planta":null,"splitter1n":null,"splitter2n":null,"caboAlim":null,"fibra1n":null,"fibra2n":null},"servicos":{"velDown":51200,"velUp":5120,"tipoTv":"DTH","tipoLinha":"TDM"},"linha":{"tipo":"TDM","dn":"4131543457","central":"PRCTA_PVS01"},"radius":{"status":"ATIVO","armario":"PRCTA_O1C50","rin":"074","velocidade":"51200 - 5120","ipFixo":"-","profile":"r5120b51200","porta":"1085","isIpFixo":false},"asserts":[{"asserts":"DIVERGENCIA_TBS_RADIUS","value":false,"creationDate":1520260277352},{"asserts":"CIRCUITO_ATIVO","value":true,"creationDate":1520260277352},{"asserts":"HAS_BLOQUEIO_RADIUS","value":false,"creationDate":1520260277352}],"eventos":[]},"valids":[{"nome":"Estado Administrativo da Porta","mensagem":"Porta Ativada (Adm state Up).","resultado":true,"foiCorrigido":false,"result":{"nome":"Estado da Porta","type":"telecom.properties.EstadoDaPorta","adminState":true,"operState":true}},{"nome":"Estado Operacional da Porta","mensagem":"Sincronismo OK.","resultado":true,"foiCorrigido":null,"result":{"nome":"Estado da Porta","type":"telecom.properties.EstadoDaPorta","adminState":true,"operState":true}},{"nome":"Parâmetros","mensagem":"Parâmetros fora dos padrões.","resultado":false,"foiCorrigido":null,"result":{"nome":"Parâmetros","type":"telecom.properties.metalico.TabelaParametrosMetalicoVdsl","snrDown":4.9,"snrUp":7.6,"atnDown":26.0,"atnUp":19.8,"velSincDown":37036.0,"velSincUp":5996.0,"velMaxDown":34344.0,"velMaxUp":8051.0,"snrDown1":4.9,"snrDown2":-65.0,"snrUp1":6.4,"snrUp2":5.9,"atnDown1":43.2,"atnDown2":130.0,"atnUp1":37.3,"atnUp2":49.0}},{"nome":"Confiabilidade de Rede","mensagem":"Rede confiável.","resultado":true,"foiCorrigido":false,"result":{"nome":"Confiabilidade de Rede","type":"telecom.properties.metalico.TabelaRedeMetalico","pctDown":19911605,"pctUp":35248317,"crcDown":0,"crcUp":4148,"fecDown":395,"fecUp":122408,"resync":0,"tempoMedicao":345600,"crcOk":true,"pctSuficiente":true}},{"nome":"Modulação","mensagem":"Modulação configurada corretamente.","resultado":true,"foiCorrigido":false,"result":{"nome":"Modulação","type":"telecom.properties.metalico.Modulacao","modulacao":"VDSL_17A_B8_12_SUV","modulEnum":"VDSL"}},{"nome":"Profile","mensagem":"Profile configurado corretamente.","resultado":true,"foiCorrigido":false,"result":{"nome":"Profile","type":"telecom.properties.ProfileMetalico","profileUp":"5","profileDown":"50","down":"VEL_51200","up":"VEL_5120"}},{"nome":"Vlan Banda Larga","mensagem":"Vlan de Banda configurado corretamente.","resultado":true,"foiCorrigido":false,"result":{"nome":"Vlan Banda Larga","type":"telecom.properties.VlanBanda","cvlan":1185,"svlan":74,"pctDown":null,"pctUp":null,"state":"UP"}},{"nome":"Vlan VoIP","mensagem":"Cliente sem VoIP.","resultado":true,"foiCorrigido":false,"result":null},{"nome":"Vlan VoD/IPTV","mensagem":"Cliente sem TV Híbrida/IPTV.","resultado":true,"foiCorrigido":false,"result":null},{"nome":"MAC do Equipamento","mensagem":"Mac identificado 28:C8:7A:19:67:18.","resultado":true,"foiCorrigido":null,"result":{"nome":"MAC do Equipamento","type":"telecom.properties.DeviceMAC","mac":"28:C8:7A:19:67:18"}}]}}');
        const f = require('../../util/mocks/fulltest.metalico.mock.json');
        console.log(f);

        cert = f;
        //GPON
        // cert = JSON.parse('{"resultado":"OK","orientacao":"OK","id":"5a9d5823cb66bf19d54c4133","blocks":[{"resultado":"OK","orientacao":"OK","asserts":[{"resultado":"OK","orientacao":"Não há bloqueio no Radius.","nome":"HAS_BLOQ_RADIUS"},{"resultado":"OK","orientacao":"Radius e Inventário de Rede OK.","nome":"IS_INV_REDE_EQUALS_RADIUS"},{"resultado":"OK","orientacao":"Inventário de Rede OK.","nome":"HAS_INV_REDE"},{"resultado":"OK","orientacao":"Inventário de Serviços OK.","nome":"HAS_INV_SERV"}],"nome":{"name":"CADASTRO","beautyName":"Cadastro"}},{"resultado":"OK","orientacao":"OK","asserts":[{"resultado":"OK","orientacao":"Vlan de Banda configurado corretamente. Vlan de VoIP configurado corretamente.","nome":"IS_VLANS_OK"},{"resultado":"OK","orientacao":"Profile configurado corretamente.","nome":"IS_PROFILE_OK"}],"nome":{"name":"SERVICOS","beautyName":"Serviços"}},{"resultado":"OK","orientacao":"OK","asserts":[],"nome":{"name":"PERFORMANCE","beautyName":"Performance"}},{"resultado":"OK","orientacao":"OK","asserts":[{"resultado":"OK","orientacao":"Porta Ativada (Adm state Up).","nome":"IS_ADM_UP"},{"resultado":"OK","orientacao":"Sincronismo/Link OK.","nome":"IS_OPER_UP"},{"resultado":"OK","orientacao":"Parâmetros dentro do padrão (entre -8 e -28).","nome":"IS_PARAM_OK"},{"resultado":"OK","orientacao":"Não foi identificada falha massiva.","nome":"IS_VIZINHO_OK"},{"resultado":"OK","orientacao":"Mac identificado 10:72:23:14:32:80.","nome":"HAS_MAC_DSLAM"}],"nome":{"name":"CONECTIVIDADE","beautyName":"Conectividade"}}],"dataInicio":1520261099337,"dataFim":1520261155655,"customer":{"designador":"CIM-81IDZUA6D-013","instancia":"2830271731","designadorAcesso":"CIM-06120648-069","designadorTv":null,"rede":{"tipo":"GPON","origem":"ONLINE","planta":"VIVO2","ipDslam":"10.227.26.15","vendorDslam":"ALCATEL","modeloDslam":"GPON_CARD","idOnt":null,"terminal":null,"ipMulticast":null,"nrc":null,"slot":6,"porta":15,"sequencial":964,"logica":4,"rin":15,"vlanVoip":1015,"vlanVod":3015,"vlanMulticast":4000,"cvlan":1064,"bhs":null},"redeExterna":{"tipo":null,"origem":null,"planta":null,"splitter1n":null,"splitter2n":null,"caboAlim":null,"fibra1n":null,"fibra2n":null},"servicos":{"velDown":51200,"velUp":5120,"tipoTv":null,"tipoLinha":"SIP"},"linha":{"tipo":"IMS","dn":"2830271731","central":"MGBHE_HMS04"},"radius":{"status":"ATIVO","armario":"ESCIM_G1A05","rin":"015","velocidade":"51200 - 5120","ipFixo":"NAO ENCONTROU","profile":"a5120b51200 op:CIM-81IDZUA6D-013","porta":"964","isIpFixo":false},"asserts":[{"asserts":"DIVERGENCIA_TBS_RADIUS","value":false,"creationDate":1520261088887},{"asserts":"CIRCUITO_ATIVO","value":true,"creationDate":1520261088887},{"asserts":"HAS_BLOQUEIO_RADIUS","value":false,"creationDate":1520261088887}],"eventos":[]},"executor":"G0034481","fulltest":{"resultado":true,"dataInicio":1520261046547,"dataFim":1520261102791,"mensagem":"Não foram identificados problemas de configuração. Se o problema/sintoma informado pelo cliente persiste, seguir o fluxo.","id":null,"cl":{"designador":"CIM-81IDZUA6D-013","instancia":"2830271731","designadorAcesso":"CIM-06120648-069","designadorTv":null,"rede":{"tipo":"GPON","origem":"ONLINE","planta":"VIVO2","ipDslam":"10.227.26.15","vendorDslam":"ALCATEL","modeloDslam":"GPON_CARD","idOnt":null,"terminal":null,"ipMulticast":null,"nrc":null,"slot":6,"porta":15,"sequencial":964,"logica":4,"rin":15,"vlanVoip":1015,"vlanVod":3015,"vlanMulticast":4000,"cvlan":1064,"bhs":null},"redeExterna":{"tipo":null,"origem":null,"planta":null,"splitter1n":null,"splitter2n":null,"caboAlim":null,"fibra1n":null,"fibra2n":null},"servicos":{"velDown":51200,"velUp":5120,"tipoTv":null,"tipoLinha":"SIP"},"linha":{"tipo":"IMS","dn":"2830271731","central":"MGBHE_HMS04"},"radius":{"status":"ATIVO","armario":"ESCIM_G1A05","rin":"015","velocidade":"51200 - 5120","ipFixo":"NAO ENCONTROU","profile":"a5120b51200 op:CIM-81IDZUA6D-013","porta":"964","isIpFixo":false},"asserts":[{"asserts":"DIVERGENCIA_TBS_RADIUS","value":false,"creationDate":1520261088887},{"asserts":"CIRCUITO_ATIVO","value":true,"creationDate":1520261088887},{"asserts":"HAS_BLOQUEIO_RADIUS","value":false,"creationDate":1520261088887}],"eventos":[]},"valids":[{"nome":"Estado Administrativo da Porta","mensagem":"Porta Ativada (Adm state Up).","resultado":true,"foiCorrigido":false,"result":{"nome":"Estado da Porta","type":"telecom.properties.EstadoDaPorta","adminState":true,"operState":true}},{"nome":"Estado Operacional da Porta","mensagem":"Sincronismo OK.","resultado":true,"foiCorrigido":null,"result":{"nome":"Estado da Porta","type":"telecom.properties.EstadoDaPorta","adminState":true,"operState":true}},{"nome":"Afetação Vizinhança","mensagem":"Não foi identificada falha massiva.","resultado":true,"foiCorrigido":null,"result":null},{"nome":"Associação Serial ONT","mensagem":"Identificado ONT associada: TLCM00015C9B.","resultado":true,"foiCorrigido":null,"result":{"nome":"Associação Serial ONT","type":"telecom.properties.gpon.SerialOntGpon","serial":"TLCM00015C9B","slot":null,"porta":null,"idOnt":null}},{"nome":"Parâmetros Ópticos","mensagem":"Parâmetros dentro do padrão (entre -8 e -28).","resultado":true,"foiCorrigido":null,"result":{"nome":"Parâmetros Ópticos","type":"telecom.properties.gpon.TabelaParametrosGpon","potOnt":-15.514,"potOlt":-18.2}},{"nome":"Profile","mensagem":"Profile configurado corretamente.","resultado":true,"foiCorrigido":false,"result":{"nome":"Profile","type":"telecom.properties.Profile","profileUp":"HSI_5M_RETAIL_UP","profileDown":"HSI_50M_RETAIL_DOWN","down":"VEL_51200","up":"VEL_5120"}},{"nome":"Vlan Banda Larga","mensagem":"Vlan de Banda configurado corretamente.","resultado":true,"foiCorrigido":false,"result":{"nome":"Vlan Banda Larga","type":"telecom.properties.VlanBanda","cvlan":1064,"svlan":15,"pctDown":null,"pctUp":null,"state":"UP"}},{"nome":"Vlan VoIP","mensagem":"Vlan de VoIP configurado corretamente.","resultado":true,"foiCorrigido":false,"result":{"nome":"Vlan VoIP","type":"telecom.properties.VlanVoip","cvlan":1064,"svlan":1015,"pctDown":null,"pctUp":null,"state":"UP"}},{"nome":"Vlan VoD/IPTV","mensagem":"Cliente sem TV.","resultado":true,"foiCorrigido":false,"result":null},{"nome":"MAC do Equipamento","mensagem":"Mac identificado 10:72:23:14:32:80.","resultado":true,"foiCorrigido":null,"result":{"nome":"MAC do Equipamento","type":"telecom.properties.DeviceMAC","mac":"10:72:23:14:32:80"}}]}}');
        return cert;
    }



}